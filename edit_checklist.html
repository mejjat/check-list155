{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Modifier la Checklist</h2>
        <a href="{{ url_for('index') }}" class="btn btn-primary">
            <i class="fas fa-arrow-left"></i> Retour
        </a>
    </div>

    <form method="POST">
        <div class="card mb-4">
            <div class="card-header">
                <h4>Informations Générales</h4>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="date_controle" class="form-label">Date de contrôle</label>
                            <input type="date" class="form-control" id="date_controle" name="date_controle" 
                                   value="{{ checklist.date_controle.strftime('%Y-%m-%d') }}" required>
                        </div>
                        <div class="mb-3">
                            <label for="type_checklist" class="form-label">Type de checklist</label>
                            <select class="form-select" id="type_checklist" name="type_checklist" required>
                                <option value="Reception" {% if checklist.type_checklist == 'Reception' %}selected{% endif %}>Réception</option>
                                <option value="Expedition" {% if checklist.type_checklist == 'Expedition' %}selected{% endif %}>Expédition</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="responsable_electrique" class="form-label">Responsable électrique</label>
                            <input type="text" class="form-control" id="responsable_electrique" name="responsable_electrique" 
                                   value="{{ checklist.responsable_electrique }}" required>
                        </div>
                        <div class="mb-3">
                            <label for="responsable_atelier" class="form-label">Responsable atelier</label>
                            <input type="text" class="form-control" id="responsable_atelier" name="responsable_atelier" 
                                   value="{{ checklist.responsable_atelier }}" required>
                        </div>
                        <div class="mb-3">
                            <label for="inspecteur_methode" class="form-label">Inspecteur méthode</label>
                            <input type="text" class="form-control" id="inspecteur_methode" name="inspecteur_methode" 
                                   value="{{ checklist.inspecteur_methode }}" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="categorie_engin" class="form-label">Catégorie engin</label>
                            <select class="form-select" id="categorie_engin" name="categorie_engin" required>
                                <option value="Bull D11" {% if checklist.categorie_engin == 'Bull D11' %}selected{% endif %}>Bull D11</option>
                                <option value="Loader 992K" {% if checklist.categorie_engin == 'Loader 992K' %}selected{% endif %}>Loader 992K</option>
                                <option value="Loader 994F1" {% if checklist.categorie_engin == 'Loader 994F1' %}selected{% endif %}>Loader 994F1</option>
                                <option value="Loader 994F2" {% if checklist.categorie_engin == 'Loader 994F2' %}selected{% endif %}>Loader 994F2</option>
                                <option value="Drill SKF1" {% if checklist.categorie_engin == 'Drill SKF1' %}selected{% endif %}>Drill SKF1</option>
                                <option value="Drill SKF2" {% if checklist.categorie_engin == 'Drill SKF2' %}selected{% endif %}>Drill SKF2</option>
                                <option value="Drill DKS" {% if checklist.categorie_engin == 'Drill DKS' %}selected{% endif %}>Drill DKS</option>
                                <option value="AUX ARR CAT" {% if checklist.categorie_engin == 'AUX ARR CAT' %}selected{% endif %}>AUX ARR CAT</option>
                                <option value="AUX NIV5" {% if checklist.categorie_engin == 'AUX NIV5' %}selected{% endif %}>AUX NIV5</option>
                                <option value="AUX NIV6" {% if checklist.categorie_engin == 'AUX NIV6' %}selected{% endif %}>AUX NIV6</option>
                                <option value="AUX NIV7" {% if checklist.categorie_engin == 'AUX NIV7' %}selected{% endif %}>AUX NIV7</option>
                                <option value="AUX PAYKOM1" {% if checklist.categorie_engin == 'AUX PAYKOM1' %}selected{% endif %}>AUX PAYKOM1</option>
                                <option value="AUX PAYKOM2" {% if checklist.categorie_engin == 'AUX PAYKOM2' %}selected{% endif %}>AUX PAYKOM2</option>
                                <option value="AUX PAYKOM3" {% if checklist.categorie_engin == 'AUX PAYKOM3' %}selected{% endif %}>AUX PAYKOM3</option>
                                <option value="Bull D9 R2" {% if checklist.categorie_engin == 'Bull D9 R2' %}selected{% endif %}>Bull D9 R2</option>
                                <option value="Bull D9 R3" {% if checklist.categorie_engin == 'Bull D9 R3' %}selected{% endif %}>Bull D9 R3</option>
                                <option value="Bull D9 R4" {% if checklist.categorie_engin == 'Bull D9 R4' %}selected{% endif %}>Bull D9 R4</option>
                                <option value="Bull D9 R5" {% if checklist.categorie_engin == 'Bull D9 R5' %}selected{% endif %}>Bull D9 R5</option>
                                <option value="Bull D9 R6" {% if checklist.categorie_engin == 'Bull D9 R6' %}selected{% endif %}>Bull D9 R6</option>
                                <option value="Bull D9 R7" {% if checklist.categorie_engin == 'Bull D9 R7' %}selected{% endif %}>Bull D9 R7</option>
                                <option value="Bull D9 R8" {% if checklist.categorie_engin == 'Bull D9 R8' %}selected{% endif %}>Bull D9 R8</option>
                                <option value="Bull D9 R9" {% if checklist.categorie_engin == 'Bull D9 R9' %}selected{% endif %}>Bull D9 R9</option>
                                <option value="Bull D9 R10" {% if checklist.categorie_engin == 'Bull D9 R10' %}selected{% endif %}>Bull D9 R10</option>
                                <option value="Bull D9 R11" {% if checklist.categorie_engin == 'Bull D9 R11' %}selected{% endif %}>Bull D9 R11</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="numero_serie_moteur" class="form-label">N° Série moteur</label>
                            <input type="text" class="form-control" id="numero_serie_moteur" name="numero_serie_moteur" 
                                   value="{{ checklist.numero_serie_moteur }}" required>
                        </div>
                        <div class="mb-3">
                            <label for="numero_serie_ecm" class="form-label">N° Série ECM</label>
                            <input type="text" class="form-control" id="numero_serie_ecm" name="numero_serie_ecm" 
                                   value="{{ checklist.numero_serie_ecm }}" required>
                        </div>
                        <div class="mb-3">
                            <label for="hm_actuel" class="form-label">HM actuel</label>
                            <input type="number" step="0.01" class="form-control" id="hm_actuel" name="hm_actuel" 
                                   value="{{ checklist.hm_actuel }}" required>
                        </div>
                        <div class="mb-3">
                            <label for="type_revision" class="form-label">Type révision</label>
                            <input type="text" class="form-control" id="type_revision" name="type_revision" 
                                   value="{{ checklist.type_revision }}" required>
                        </div>
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="completed" name="completed" 
                                   {% if checklist.completed %}checked{% endif %}>
                            <label class="form-check-label" for="completed">Checklist complétée</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Capteurs -->
        <div class="card mb-4">
            <div class="card-header">
                <h4>Contrôle des Capteurs</h4>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        {% for id, label in [
                            ('capteur_regime_moteur', 'Capteur régime moteur'),
                            ('capteur_temp_liquide', 'Capteur température liquide'),
                            ('switch_temp_eau', 'Switch température eau'),
                            ('palpeur_debit_liquide', 'Palpeur débit liquide'),
                            ('capteur_pression_huile', 'Capteur pression huile'),
                            ('capteur_niveau_huile', 'Capteur niveau huile'),
                            ('capteur_pression_admission', 'Capteur pression admission'),
                            ('capteur_temp_admission', 'Capteur température admission'),
                            ('capteur_temp_echap_droit', 'Capteur température échappement droit'),
                            ('capteur_temp_echap_gauche', 'Capteur température échappement gauche')
                        ] %}
                        <div class="mb-3">
                            <label for="{{ id }}" class="form-label">{{ label }}</label>
                            <div class="col-md-6">
                                <select class="form-select" name="{{ id }}">
                                    <option value="NA" {% if getattr(checklist, id) == 'NA' %}selected{% endif %}>NA</option>
                                    <option value="manquant" {% if getattr(checklist, id) == 'manquant' %}selected{% endif %}>Manquant</option>
                                    <option value="neuf" {% if getattr(checklist, id) == 'neuf' %}selected{% endif %}>Neuf</option>
                                    <option value="bon" {% if getattr(checklist, id) == 'bon' %}selected{% endif %}>Bon</option>
                                    <option value="mauvais" {% if getattr(checklist, id) == 'mauvais' %}selected{% endif %}>Mauvais</option>
                                </select>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    <div class="col-md-6">
                        {% for id, label in [
                            ('capteur_temp_air_ambiant', 'Capteur température air ambiant'),
                            ('capteur_pression_gasoil', 'Capteur pression gasoil'),
                            ('switch_pression_gasoil', 'Switch pression gasoil'),
                            ('capteur_pression_carter', 'Capteur pression carter'),
                            ('switch_pression_huile', 'Switch pression huile'),
                            ('capteur_regime_primaire', 'Capteur régime primaire'),
                            ('capteur_regime_secondaire', 'Capteur régime secondaire'),
                            ('capteur_vitesse_convertisseur', 'Capteur vitesse convertisseur'),
                            ('capteur_temp_convertisseur', 'Capteur température convertisseur'),
                            ('capteur_pression_atmo', 'Capteur pression atmosphérique')
                        ] %}
                        <div class="mb-3">
                            <label for="{{ id }}" class="form-label">{{ label }}</label>
                            <div class="col-md-6">
                                <select class="form-select" name="{{ id }}">
                                    <option value="NA" {% if getattr(checklist, id) == 'NA' %}selected{% endif %}>NA</option>
                                    <option value="manquant" {% if getattr(checklist, id) == 'manquant' %}selected{% endif %}>Manquant</option>
                                    <option value="neuf" {% if getattr(checklist, id) == 'neuf' %}selected{% endif %}>Neuf</option>
                                    <option value="bon" {% if getattr(checklist, id) == 'bon' %}selected{% endif %}>Bon</option>
                                    <option value="mauvais" {% if getattr(checklist, id) == 'mauvais' %}selected{% endif %}>Mauvais</option>
                                </select>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Circuit de Démarrage -->
        <div class="card mb-4">
            <div class="card-header">
                <h4>Circuit de Démarrage</h4>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        {% for id, label in [
                            ('demarreur_1', 'Démarreur 1'),
                            ('demarreur_2', 'Démarreur 2'),
                            ('alternateur_charge', 'Alternateur charge')
                        ] %}
                        <div class="mb-3">
                            <label for="{{ id }}" class="form-label">{{ label }}</label>
                            <div class="col-md-6">
                                <select class="form-select" name="{{ id }}">
                                    <option value="NA" {% if getattr(checklist, id) == 'NA' %}selected{% endif %}>NA</option>
                                    <option value="manquant" {% if getattr(checklist, id) == 'manquant' %}selected{% endif %}>Manquant</option>
                                    <option value="neuf" {% if getattr(checklist, id) == 'neuf' %}selected{% endif %}>Neuf</option>
                                    <option value="bon" {% if getattr(checklist, id) == 'bon' %}selected{% endif %}>Bon</option>
                                    <option value="mauvais" {% if getattr(checklist, id) == 'mauvais' %}selected{% endif %}>Mauvais</option>
                                </select>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    <div class="col-md-6">
                        {% for id, label in [
                            ('courroie_alternateur', 'Courroie alternateur'),
                            ('tendeur_courroie', 'Tendeur courroie'),
                            ('etat_tension_courroie', 'État tension courroie')
                        ] %}
                        <div class="mb-3">
                            <label for="{{ id }}" class="form-label">{{ label }}</label>
                            <div class="col-md-6">
                                <select class="form-select" name="{{ id }}">
                                    <option value="NA" {% if getattr(checklist, id) == 'NA' %}selected{% endif %}>NA</option>
                                    <option value="manquant" {% if getattr(checklist, id) == 'manquant' %}selected{% endif %}>Manquant</option>
                                    <option value="neuf" {% if getattr(checklist, id) == 'neuf' %}selected{% endif %}>Neuf</option>
                                    <option value="bon" {% if getattr(checklist, id) == 'bon' %}selected{% endif %}>Bon</option>
                                    <option value="mauvais" {% if getattr(checklist, id) == 'mauvais' %}selected{% endif %}>Mauvais</option>
                                </select>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Contrôle Branchement et Câblage -->
        <div class="card mb-4">
            <div class="card-header">
                <h4>Contrôle Branchement et Câblage</h4>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        {% for id, label in [
                            ('faisceau_electrique', 'Faisceau électrique'),
                            ('branchement_electrique', 'Branchement électrique'),
                            ('attachement_isolation', 'Attachement et isolation')
                        ] %}
                        <div class="mb-3">
                            <label for="{{ id }}" class="form-label">{{ label }}</label>
                            <div class="col-md-6">
                                <select class="form-select" name="{{ id }}">
                                    <option value="NA" {% if getattr(checklist, id) == 'NA' %}selected{% endif %}>NA</option>
                                    <option value="manquant" {% if getattr(checklist, id) == 'manquant' %}selected{% endif %}>Manquant</option>
                                    <option value="neuf" {% if getattr(checklist, id) == 'neuf' %}selected{% endif %}>Neuf</option>
                                    <option value="bon" {% if getattr(checklist, id) == 'bon' %}selected{% endif %}>Bon</option>
                                    <option value="mauvais" {% if getattr(checklist, id) == 'mauvais' %}selected{% endif %}>Mauvais</option>
                                </select>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <div class="text-center mb-4">
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-save"></i> Enregistrer les modifications
            </button>
        </div>
    </form>
</div>
{% endblock %}
